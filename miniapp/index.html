<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Mini App</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #181c22;
      color: #f1f1f1;
      font-family: 'Inter', Arial, sans-serif;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      overflow: hidden;
    }
    .container {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: transparent;
      box-shadow: none;
      border-radius: 0;
      padding: 0;
      position: relative;
    }
    .header {
      width: 100vw;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.2em 1.2em 0.5em 1.2em;
      background: transparent;
      z-index: 1002;
    }
    .app-title {
      font-size: 1.2em;
      font-weight: 700;
      color: #7ecfff;
      letter-spacing: 1px;
    }
    .key-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #23272f;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px #0003;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }
    .key-btn:hover {
      background: #2d323b;
    }
    .key-btn svg {
      width: 22px;
      height: 22px;
      fill: #7ecfff;
    }
    .apikey-float {
      display: none;
      position: fixed;
      top: 70px;
      right: 24px;
      z-index: 1001;
      background: #23272f;
      padding: 1.2em 1.2em 1em 1.2em;
      border-radius: 18px;
      box-shadow: 0 4px 24px #0008;
      min-width: 180px;
      max-width: 320px;
      width: 100%;
      overflow: hidden;
    }
    .apikey-float.active {
      display: block;
      animation: fadeIn 0.2s;
    }
    .apikey-float input {
      width: 100%;
      min-width: 0;
      max-width: 220px;
      padding: 0.7em 1em;
      border-radius: 10px;
      border: 1px solid #333a;
      background: #181c22;
      color: #f1f1f1;
      font-size: 1em;
      margin-bottom: 0.5em;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .apikey-float label {
      font-size: 0.98em;
      color: #7ecfff;
      margin-bottom: 0.3em;
      display: block;
    }
    .user {
      margin: 0.5em 0 0.5em 1.2em;
      font-size: 1.05em;
      color: #7ecfff;
      opacity: 0.85;
    }
    .chatbox {
      flex: 1 1 auto;
      width: 100vw;
      overflow-y: auto;
      padding: 1.2em 0.8em 1.2em 0.8em;
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: 0.7em;
      font-size: 1.04em;
      scroll-behavior: smooth;
      padding-bottom: 5em; /* —á—Ç–æ–±—ã input-row –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª */
    }
    .msg {
      max-width: 80vw;
      padding: 0.9em 1.2em;
      border-radius: 18px;
      margin-bottom: 0.2em;
      word-break: break-word;
      box-shadow: 0 2px 8px #0002;
      background: #23272f;
      color: #f1f1f1;
      align-self: flex-start;
    }
    .msg.user {
      background: #1a6cff;
      color: #fff;
      align-self: flex-end;
      box-shadow: 0 2px 8px #1a6cff33;
    }
    .msg.assistant {
      background: #23272f;
      color: #f1f1f1;
    }
    .booking-card {
      background: #23272f;
      color: #f1f1f1;
      border-radius: 18px;
      box-shadow: 0 2px 12px #0004;
      margin: 0.7em 0;
      padding: 1.2em 1em 1em 1em;
      position: relative;
      max-width: 98vw;
      font-size: 1.04em;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .booking-card.selected {
      border: 2px solid #7ecfff;
      box-shadow: 0 0 0 2px #7ecfff33;
    }
    .booking-btn, .booking-btn.confirm-btn {
      background: #1a6cff;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 0.6em 1.3em;
      font-weight: 600;
      cursor: pointer;
      margin: 0.5em 0.2em 0 0;
      font-size: 1em;
      transition: background 0.2s;
      box-shadow: 0 2px 8px #1a6cff22;
    }
    .booking-btn:hover, .booking-btn.confirm-btn:hover {
      background: #7ecfff;
      color: #181c22;
    }
    .input-row {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      width: 100vw;
      background: transparent;
      display: flex;
      gap: 0.5em;
      padding: 0.7em 1.2em 1.2em 1.2em;
      z-index: 1001;
      align-items: flex-end;
    }
    .input-row input {
      flex: 1;
      padding: 0.9em 1.2em;
      border-radius: 18px;
      border: 1px solid #333a;
      background: #23272f;
      color: #f1f1f1;
      font-size: 1.08em;
      outline: none;
      margin-right: 0.2em;
      box-shadow: 0 2px 8px #0002;
    }
    .input-row button {
      background: #1a6cff;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.3em;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 8px #1a6cff33;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .input-row button:hover {
      background: #7ecfff;
      color: #181c22;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(24,28,34,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal.active {
      display: flex;
      animation: fadeIn 0.2s;
    }
    .modal-content {
      background: #23272f;
      border-radius: 18px;
      padding: 2em 1.5em 1.5em 1.5em;
      box-shadow: 0 4px 24px #0008;
      min-width: 280px;
      max-width: 95vw;
      margin: 0 auto;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .modal-close {
      position: absolute;
      top: 1em; right: 1em;
      font-size: 1.5em;
      color: #7ecfff;
      cursor: pointer;
      z-index: 10;
    }
    @media (max-width: 600px) {
      .chatbox, .msg, .booking-card {
        font-size: 0.98em;
        padding-left: 0.5em;
        padding-right: 0.5em;
      }
      .input-row {
        padding-left: 0.5em;
        padding-right: 0.5em;
      }
      .apikey-float {
        right: 8px;
        min-width: 180px;
      }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <span class="app-title">NOW v14.32</span>
      <div style="display: flex; gap: 0.7em; align-items: center;">
        <button class="key-btn" id="booking-btn" title="–û—Ñ–æ—Ä–º–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#23272f"/><path d="M12 7v5l4 2" stroke="#7ecfff" stroke-width="2" fill="none"/></svg>
        </button>
        <button class="key-btn" id="show-key-btn" title="API Key">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#23272f"/><path d="M17.7 13.35a3.5 3.5 0 1 0-1.41 1.41l2.13 2.13a1 1 0 0 0 1.41-1.41l-2.13-2.13zm-5.2.65a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill="#7ecfff"/></svg>
        </button>
      </div>
    </div>
    <div class="apikey-float" id="apikey-float">
      <label for="api-key">API Key</label>
      <input type="password" id="api-key" placeholder="–í–≤–µ–¥–∏—Ç–µ Gemini API Key" autocomplete="off" />
    </div>
    <div class="user" id="user-info">Loading user info...</div>
    <div class="chatbox" id="chatbox"></div>
    <form id="chat-form" class="input-row" autocomplete="off" onsubmit="return false;">
      <input type="text" id="user-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∑–∞–±—Ä–æ–Ω–∏—Ä—É–π —Å—Ç–æ–ª–∏–∫ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –Ω–∞ –≤–µ—á–µ—Ä" required />
      <button type="button" id="send-btn" title="Send">&#10148;</button>
    </form>
    <!-- Payment Modal -->
    <div class="modal" id="payment-modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closePaymentModal()">&times;</span>
        <h3>üí≥ –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–∞—Ä—Ç—É</h3>
        <div id="modal-booking-details"></div>
        <div style="margin: 1em 0;">
          <input type="text" id="card-number" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: 1234 5678 9012 3456" maxlength="19" />
          <input type="text" id="card-expiry" placeholder="MM/YY" maxlength="5" />
          <input type="text" id="card-cvv" placeholder="CVV" maxlength="3" />
          <input type="text" id="card-name" placeholder="–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã" />
        </div>
        <button type="button" id="pay-btn" style="width: 100%;">üí≥ –ü—Ä–∏–≤—è–∑–∞—Ç—å</button>
      </div>
    </div>
  </div>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª—è API-–∫–ª—é—á–∞
    const showKeyBtn = document.getElementById('show-key-btn');
    const apikeyFloat = document.getElementById('apikey-float');
    showKeyBtn.onclick = () => {
      apikeyFloat.classList.toggle('active');
      if (apikeyFloat.classList.contains('active')) {
        document.getElementById('api-key').focus();
      }
    };

    // –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"
    const bookingBtn = document.getElementById('booking-btn');
    const paymentModal = document.getElementById('payment-modal');
    bookingBtn.onclick = () => {
      paymentModal.classList.add('active');
    };
    function closePaymentModal() {
      paymentModal.classList.remove('active');
    }

    // Telegram user info
    const tg = window.Telegram.WebApp;
    tg.ready();
    const userInfo = document.getElementById('user-info');
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const user = tg.initDataUnsafe.user;
      userInfo.textContent = `Hello, ${user.first_name} ${user.last_name || ''} (@${user.username || 'no username'})!`;
    } else {
      userInfo.textContent = 'User info not available.';
    }

    // Get DOM elements
    const chatbox = document.getElementById('chatbox');
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const apiKeyInput = document.getElementById('api-key');

    // Available data files mapping
    const dataFiles = {
      'events-moscow': '/NOW/miniapp/events-moscow.json',
      'events-spb': '/NOW/miniapp/events-spb.json',
      'people-moscow': '/NOW/miniapp/people-moscow.json',
      'contractors-moscow': '/NOW/miniapp/contractors-moscow.json',
      'services-moscow': '/NOW/miniapp/services-moscow.json'
    };

    let currentData = {};
    let dataLoaded = false;
    let messages = [];
    let selectedItem = null; // Store selected booking item

    function appendMessage(role, content, bookingData = null) {
      const div = document.createElement('div');
      div.className = 'msg ' + role;
      const textDiv = document.createElement('div');
      textDiv.textContent = (role === 'user' ? 'You: ' : 'Assistant: ') + content;
      div.appendChild(textDiv);
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // Gemini API endpoint
    const GEMINI_ENDPOINT = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è GPT (–æ–±—ä—è—Å–Ω–µ–Ω–∏—è), –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    function extractGptComment(reply, items) {
      if (!reply) return '';
      let text = reply;
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç hash: <hash>
      const lines = text.split('\n');
      const hashPattern = /hash:\s*[a-fA-F0-9]{8,}/;
      const ignorePatterns = [
        /^\s*[-*‚Ä¢\d\.]+/, // markdown-—Å–ø–∏—Å–∫–∏, —ç–º–æ–¥–∑–∏, —Ü–∏—Ñ—Ä—ã
        /^\s*\*\*/, // –∂–∏—Ä–Ω—ã–µ markdown
        /^\s*–û–ø–∏—Å–∞–Ω–∏–µ:/i,
        /^\s*–ú–µ—Å—Ç–æ:/i,
        /^\s*–î–∞—Ç–∞:/i,
        /^\s*–í—Ä–µ–º—è:/i,
        /^\s*–¶–µ–Ω–∞:/i,
        /^\s*–ö–æ–Ω—Ç–∞–∫—Ç:/i,
        /^\s*–†–µ–π—Ç–∏–Ω–≥:/i,
        /^\s*–£—Å–ª—É–≥–∞:/i,
        /^\s*–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:/i,
        /^\s*–û–ø—ã—Ç:/i
      ];
      let filtered = lines.filter(line => {
        if (!line.trim()) return false;
        if (hashPattern.test(line)) return false;
        if (ignorePatterns.some(re => re.test(line))) return false;
        if (Array.isArray(items)) {
          for (const item of items) {
            if (item.name && line.includes(item.name)) return false;
            if (item.description && line.includes(item.description)) return false;
            if (item.venue && line.includes(item.venue)) return false;
            if (item.price_range && line.includes(item.price_range)) return false;
            if (item.currency && line.includes(item.currency)) return false;
          }
        }
        return true;
      });
      const comment = filtered.join(' ').replace(/\s+/g, ' ').trim();
      if (comment.length > 10) return comment;
      return '';
    }

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ hash –∏–∑ –æ—Ç–≤–µ—Ç–∞ GPT
    function filterMentionedItemsByHash(items, replyText) {
      // –ù–∞–π—Ç–∏ –≤—Å–µ hash: <hash> –≤ –æ—Ç–≤–µ—Ç–µ
      const hashes = Array.from(replyText.matchAll(/hash:\s*([a-fA-F0-9]{8,})/g)).map(m => m[1]);
      return items.filter(item => hashes.includes(item.hash));
    }

    // –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    function renderBookingCards(items) {
      // Remove previous cards
      const oldCards = document.querySelectorAll('.booking-card');
      oldCards.forEach(card => card.remove());
      // State: only one selected at a time
      let selectedCard = null;
      let selectedBookingItem = null;
      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'booking-card';
        card.style = 'background:#23272f;margin:1em 0;padding:1em;border-radius:18px;box-shadow:0 2px 8px #0004;position:relative;';
        let html = `<strong style="color:#7ecfff;">${item.name}</strong><br>`;
        if (item.venue) html += `–ú–µ—Å—Ç–æ: ${item.venue}<br>`;
        if (item.date) html += `–î–∞—Ç–∞: ${item.date}<br>`;
        if (item.time) html += `–í—Ä–µ–º—è: ${item.time}<br>`;
        if (item.price_range) html += `–¶–µ–Ω–∞: ${item.price_range} ${item.currency || 'RUB'}<br>`;
        if (item.specialization) html += `–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: ${item.specialization}<br>`;
        if (item.experience) html += `–û–ø—ã—Ç: ${item.experience}<br>`;
        if (item.rating) html += `–†–µ–π—Ç–∏–Ω–≥: ${item.rating}<br>`;
        if (item.contact) html += `–ö–æ–Ω—Ç–∞–∫—Ç: ${item.contact}<br>`;
        if (item.description) html += `–û–ø–∏—Å–∞–Ω–∏–µ: ${item.description}<br>`;
        card.innerHTML = html;
        // –í—ã–±—Ä–∞—Ç—å
        const selectBtn = document.createElement('button');
        selectBtn.className = 'booking-btn';
        selectBtn.textContent = '–í—ã–±—Ä–∞—Ç—å';
        selectBtn.onclick = () => {
          document.querySelectorAll('.booking-card.selected').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          selectedBookingItem = item;
          document.querySelectorAll('.booking-card .confirm-btn').forEach(b => b.style.display = 'none');
          confirmBtn.style.display = 'inline-block';
        };
        card.appendChild(selectBtn);
        // –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞)
        const confirmBtn = document.createElement('button');
        confirmBtn.className = 'booking-btn confirm-btn';
        confirmBtn.style.background = '#28a745';
        confirmBtn.style.display = 'none';
        confirmBtn.textContent = `üí≥ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å${item.price_range ? ' –∑–∞ ' + item.price_range + ' ' + (item.currency || 'RUB') : ''}`;
        confirmBtn.onclick = () => showPaymentForm(item);
        card.appendChild(confirmBtn);
        document.getElementById('chatbox').appendChild(card);
      });
    }

    // Handle form submission
    chatForm.onsubmit = async (e) => {
      e.preventDefault();
      e.stopPropagation();

      const apiKey = document.getElementById('api-key').value.trim();
      if (!apiKey) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à Gemini API Key!');
        return;
      }

      const content = userInput.value.trim();
      if (!content) return;

      appendMessage('user', content);
      userInput.value = '';
      appendMessage('assistant', '–û–ø—Ä–µ–¥–µ–ª—è—é –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...');

      try {
        // First, ask Gemini to determine which data file is needed
        const fileSelectionPrompt = `You are a data file selector. Based on the user's request, determine which JSON file should be loaded.\n\nAvailable files:\n- events-moscow.json (events in Moscow)\n- events-spb.json (events in Saint Petersburg) \n- people-moscow.json (professionals in Moscow)\n- contractors-moscow.json (construction/repair services in Moscow)\n- services-moscow.json (various services in Moscow)\n\nRespond ONLY with the filename (e.g., "events-moscow") without .json extension.`;

        // Gemini file selection request
        const fileRes = await fetch(GEMINI_ENDPOINT + '?key=' + apiKey, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json; charset=utf-8'
          },
          body: JSON.stringify({
            contents: [
              { parts: [ { text: fileSelectionPrompt + "\n\n" + content } ] }
            ]
          })
        });
        const fileData = await fileRes.json();
        let selectedFile = '';
        if (fileData.candidates && fileData.candidates[0] && fileData.candidates[0].content && fileData.candidates[0].content.parts && fileData.candidates[0].content.parts[0]) {
          selectedFile = fileData.candidates[0].content.parts[0].text.trim().toLowerCase();
        }
        // Load the selected data file
        if (dataFiles[selectedFile]) {
          try {
            const dataRes = await fetch(dataFiles[selectedFile]);
            if (!dataRes.ok) {
              throw new Error(`HTTP ${dataRes.status}: ${dataRes.statusText}`);
            }
            const loadedData = await dataRes.json();
            currentData = loadedData;
            dataLoaded = true;
          } catch (dataError) {
            chatbox.removeChild(chatbox.lastChild);
            appendMessage('assistant', '–û—à–∏–±–∫–∞: ' + dataError.message);
            return;
          }
          chatbox.removeChild(chatbox.lastChild);
          // Now create the main response with loaded data
          const systemPrompt = `You are an AI assistant for a comprehensive booking and service platform. You have access to the following data:\n\n${JSON.stringify(currentData, null, 2)}\n\nYour task is to help users with:\n- Booking events and venues\n- Finding professionals and experts\n- Hiring contractors for services\n- Accessing various local services\n\nIMPORTANT: For each suggested option, you MUST include its hash from the data (e.g., hash: abc123). For every option, write a line like: hash: <hash>.\n\nWhen the user confirms booking, respond as before.`;
          // Gemini main response request
          const mainRes = await fetch(GEMINI_ENDPOINT + '?key=' + apiKey, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json; charset=utf-8'
            },
            body: JSON.stringify({
              contents: [
                { parts: [ { text: systemPrompt + "\n\n" + content } ] }
              ]
            })
          });
          const mainData = await mainRes.json();
          if (mainData.candidates && mainData.candidates[0] && mainData.candidates[0].content && mainData.candidates[0].content.parts && mainData.candidates[0].content.parts[0]) {
            const reply = mainData.candidates[0].content.parts[0].text.trim();
            let mentionedItems = [];
            if (currentData.data && Array.isArray(currentData.data) && currentData.data.length > 0) {
              mentionedItems = filterMentionedItemsByHash(currentData.data, reply);
              let comment = extractGptComment(reply, mentionedItems);
              if (comment) {
                appendMessage('assistant', comment, null);
              }
              if (mentionedItems.length > 0) {
                renderBookingCards(mentionedItems);
              }
            }
          } else {
            appendMessage('assistant', '–û—à–∏–±–∫–∞: ' + (mainData.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
          }
        } else {
          chatbox.removeChild(chatbox.lastChild);
          appendMessage('assistant', `–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (${selectedFile}). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å.`);
        }
      } catch (err) {
        chatbox.removeChild(chatbox.lastChild);
        appendMessage('assistant', '–û—à–∏–±–∫–∞: ' + err.message);
      }
    };

    // Handle send button click
    document.getElementById('send-btn').onclick = async () => {
      chatForm.onsubmit(new Event('submit'));
    };

    // Payment logic (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–æ)
    // ... –≤–∞—à –∫–æ–¥ –æ–ø–ª–∞—Ç—ã –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ...
  </script>
</body>
</html>
